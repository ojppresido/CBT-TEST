<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mathematics Diagram Integration Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .question-card {
            border: 1px solid #ddd;
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .question-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .diagram-container {
            margin: 15px 0;
            padding: 10px;
            border: 1px solid #eee;
            background-color: white;
            border-radius: 4px;
        }
        .diagram-container h5 {
            margin: 0 0 10px 0;
            color: #555;
        }
        .question-text {
            margin-bottom: 15px;
            line-height: 1.5;
        }
        .test-section {
            margin: 30px 0;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .diagram-container {
            margin: 15px 0;
            padding: 10px;
            border: 1px solid #eee;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        .diagram-container h5 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .question-id {
            background-color: #e7f3ff;
            padding: 5px 10px;
            border-radius: 3px;
            display: inline-block;
            margin-bottom: 10px;
        }
        .options {
            margin: 15px 0;
        }
        .option {
            margin: 5px 0;
            padding: 8px;
            border: 1px solid #eee;
            border-radius: 3px;
        }
        .explanation {
            background-color: #f0f8ff;
            padding: 15px;
            margin-top: 15px;
            border-radius: 4px;
            border-left: 4px solid #007cba;
        }
    </style>
</head>
<body>
    <h1>Mathematics Diagram Integration Test</h1>
    <p>This page demonstrates how the centralized diagram system works with mathematics questions.</p>

    <div id="questions-container">
        <!-- Questions will be loaded here -->
    </div>

    <script>
        // Simulate loading questions with diagrams
        // In a real application, this would come from your backend
        const questions = [
            {
                id: 6,
                question: "The bearing of town B from town A is 135°. What is the bearing of A from B?",
                options: [
                    { id: "A", text: "045°" },
                    { id: "B", text: "225°" },
                    { id: "C", text: "315°" },
                    { id: "D", text: "135°" }
                ],
                correctAnswer: "C",
                explanation: "Bearings are always measured clockwise from North..."
            },
            {
                id: 12,
                question: "A chord of length 12 cm is 8 cm from the centre of a circle. Find the radius.",
                options: [
                    { id: "A", text: "6 cm" },
                    { id: "B", text: "8 cm" },
                    { id: "C", text: "10 cm" },
                    { id: "D", text: "12 cm" }
                ],
                correctAnswer: "C",
                explanation: "Circle geometry relies on key theorems..."
            },
            {
                id: 19,
                question: "Find the volume of a cone of radius 7 cm and height 12 cm.",
                options: [
                    { id: "A", text: "308 cm³" },
                    { id: "B", text: "616 cm³" },
                    { id: "C", text: "924 cm³" },
                    { id: "D", text: "1232 cm³" }
                ],
                correctAnswer: "B",
                explanation: "Volume formulas are must-knows. For a cone..."
            }
        ];

        // This would be replaced with actual API call to get diagrams
        async function getDiagramByQuestionId(questionId) {
            // In a real application, this would fetch from the centralized diagram map
            // For this demo, we'll simulate it by returning a placeholder
            try {
                const response = await fetch('/workspace/math_diagram_map.json');
                const diagramMap = await response.json();
                return diagramMap[questionId] || null;
            } catch (error) {
                console.error('Error fetching diagram:', error);
                return null;
            }
        }

        // Function to render a question with its diagram
        function renderQuestion(question) {
            const hasDiagram = [6, 12, 17, 19].includes(question.id); // Based on our processed results
            
            const questionHTML = `
                <div class="question-container">
                    <div class="question-id">Question ID: ${question.id}</div>
                    <h3>${question.question}</h3>
                    
                    <div class="options">
                        ${question.options.map(opt => 
                            `<div class="option"><strong>${opt.id}:</strong> ${opt.text}</div>`
                        ).join('')}
                    </div>
                    
                    ${hasDiagram ? `
                    <div class="diagram-container">
                        <h5>Diagram:</h5>
                        <div id="diagram-${question.id}">Loading diagram...</div>
                    </div>
                    ` : ''}
                    
                    <div class="explanation">
                        <strong>Explanation:</strong> ${question.explanation.substring(0, 100)}...
                    </div>
                </div>
            `;
            
            return questionHTML;
        }

        // Load and display questions
        function loadQuestions() {
            const container = document.getElementById('questions-container');
            
            questions.forEach(question => {
                container.innerHTML += renderQuestion(question);
            });
            
            // Now load diagrams for questions that have them
            questions.forEach(async question => {
                if ([6, 12, 19].includes(question.id)) { // Questions with diagrams
                    try {
                        // In a real application, this would fetch from the centralized diagram service
                        const diagramElement = document.getElementById(`diagram-${question.id}`);
                        
                        // For demo purposes, we'll use the actual diagram content
                        let diagramHTML = '';
                        
                        if (question.id === 6) {
                            diagramHTML = `<svg width="300" height="300" viewBox="0 0 300 300" xmlns="http://www.w3.org/2000/svg">
                              <!-- Circle representing compass -->
                              <circle cx="150" cy="150" r="120" stroke="black" stroke-width="2" fill="white"/>
                              
                              <!-- North, South, East, West labels -->
                              <text x="150" y="40" text-anchor="middle" font-size="14" font-weight="bold">N</text>
                              <text x="150" y="275" text-anchor="middle" font-size="14" font-weight="bold">S</text>
                              <text x="265" y="155" text-anchor="middle" font-size="14" font-weight="bold">E</text>
                              <text x="35" y="155" text-anchor="middle" font-size="14" font-weight="bold">W</text>
                              
                              <!-- Cardinal direction lines -->
                              <line x1="150" y1="30" x2="150" y2="270" stroke="gray" stroke-width="1" stroke-dasharray="5,5"/>
                              <line x1="30" y1="150" x2="270" y2="150" stroke="gray" stroke-width="1" stroke-dasharray="5,5"/>
                              <line x1="60" y1="60" x2="240" y2="240" stroke="gray" stroke-width="1" stroke-dasharray="5,5"/>
                              <line x1="240" y1="60" x2="60" y2="240" stroke="gray" stroke-width="1" stroke-dasharray="5,5"/>
                              
                              <!-- Bearing line -->
                              <line x1="150" y1="150" x2="220.71" y2="220.71" stroke="red" stroke-width="3"/>
                              
                              <!-- Bearing angle arc -->
                              <path d="M160,140 A10 10 0 0 1 164.14,164.14" fill="none" stroke="blue" stroke-width="2"/>
                              
                              <!-- Bearing label -->
                              <text x="186.96" y="134.69" font-size="12" fill="blue">135°</text>
                            </svg>`;
                        } else if (question.id === 12) {
                            diagramHTML = `<svg width="300" height="300" viewBox="0 0 300 300" xmlns="http://www.w3.org/2000/svg">
                              <!-- Circle -->
                              <circle cx="150" cy="150" r="100" stroke="black" stroke-width="2" fill="none"/>
                              
                              <!-- Chord -->
                              <line x1="100" y1="200" x2="200" y2="200" stroke="red" stroke-width="3"/>
                              
                              <!-- Perpendicular from center to chord -->
                              <line x1="150" y1="150" x2="150" y2="200" stroke="blue" stroke-width="2" stroke-dasharray="5,5"/>
                              
                              <!-- Radius to one end of chord -->
                              <line x1="150" y1="150" x2="200" y2="200" stroke="green" stroke-width="2"/>
                              
                              <!-- Labels -->
                              <text x="155" y="180" font-size="12" fill="blue">8 cm</text>
                              <text x="175" y="205" font-size="12" fill="red">12 cm</text>
                              <text x="180" y="180" font-size="12" fill="green">r = ?</text>
                              <text x="155" y="145" font-size="12" fill="black">O</text>
                              <text x="195" y="205" font-size="12" fill="black">A</text>
                              <text x="95" y="205" font-size="12" fill="black">B</text>
                              <text x="155" y="205" font-size="12" fill="black">M</text>
                            </svg>`;
                        } else if (question.id === 19) {
                            diagramHTML = `<svg width="200" height="250" viewBox="0 0 200 250" xmlns="http://www.w3.org/2000/svg">
                              <!-- Cone -->
                              <path d="M100,50 L30,200 Q100,230 170,200 Z" fill="none" stroke="black" stroke-width="2"/>
                              
                              <!-- Base circle (ellipse) -->
                              <ellipse cx="100" cy="200" rx="70" ry="15" fill="none" stroke="black" stroke-width="2"/>
                              
                              <!-- Height line -->
                              <line x1="100" y1="50" x2="100" y2="200" stroke="red" stroke-width="2" stroke-dasharray="5,5"/>
                              
                              <!-- Radius line -->
                              <line x1="100" y1="200" x2="170" y2="200" stroke="blue" stroke-width="2"/>
                              
                              <!-- Labels -->
                              <text x="105" y="130" font-size="12" fill="red">h=12cm</text>
                              <text x="130" y="215" font-size="12" fill="blue">r=7cm</text>
                            </svg>`;
                        }
                        
                        diagramElement.innerHTML = diagramHTML;
                    } catch (error) {
                        console.error(`Error loading diagram for question ${question.id}:`, error);
                        const diagramElement = document.getElementById(`diagram-${question.id}`);
                        diagramElement.innerHTML = '<p style="color: red;">Error loading diagram</p>';
                    }
                }
            });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', loadQuestions);
    </script>
</body>
</html>